---
layout: post
title:  "Array.prototype"
date:   2014-10-30 3:14:15AM
excerpt: "Implementations of each, where & any for arrays in Javascript."
categories: javascript
codeType: javascript
---

<p>Almost every friday there is this thing called Nearsoft Academy at <a href="http://nearsoft.com/">Nearsoft Inc.</a> where they teach and explain pretty neat stuff about diverse areas in programming.<br>About two sessions ago they explained how the each, where & any methods work for arrays and asked us to make our own implementations and explain them. I haven't given myself the opportunity to write about it or post it here but now is the time, here I go:</p>
<ul>
    <li><h1>each()</h1>
        <p>Let's say we have some JSON data and we want to extract stuff from it.</p>
<pre><code data-language="javascript">//Here is our example JSON data, some people's names along with
//their age and stuff they like.
var humans = [ 
  {name: 'Alan', age: 41, likes: ['Computer Science', 'Netflix', 'Artificial Intelligence']  },
  {name: 'Randy', age: 32, likes: ['Cryptography', 'Netflix', 'Reading']  },
  {name: 'Bobby', age: 25, likes: ['Paintball', 'Coding']  },
  {name: 'Lawrence', age: 30, likes: ['Music', 'Netflix', 'Coding']  },
  {name: 'James', age: 22, likes: ['Videogames', 'Dungeons & Dragons', 'Reading', 'Reddit']  }
];</code></pre>
        <p>So if we wanted to, let's say, print each of the objects contained in humans, including the likes of each of the objects with a special message, we can do this:</p>
<pre><code data-language="javascript">//We want to easily iterate through all of that information.
humans.each(function(element,i){
    console.log(i+1 + ". " + element.name + " is " + element.age + " years old and likes " + element.likes + ".");
});
/* Output: //////
1. Alan is 41 years old and likes Computer Science,Netflix,Artificial Intelligence.
2. Randy is 32 years old and likes Cryptography,Netflix,Reading.
3. Bobby is 25 years old and likes Paintball,Coding.
4. Lawrence is 30 years old and likes Music,Netflix,Coding.
5. James is 22 years old and likes Videogames,Dungeons & Dragons,Reading,Reddit.
*/</code></pre>
        <p>Neat huh? So we are sending a function as a parameter. Well it isn't magic but it is pretty tricky, here we'll check out the .each() function:</p>
<pre><code data-language="javascript">Array.prototype.each = function (callback) {
    for (var i=0; i&lt;this.length; i++) {
        callback.call(this[i], this[i], i);
    }
};</code></pre>
<p>I'll try and explain as best as I can.<br> We can see that we are sending an <a href="http://en.wikibooks.org/wiki/JavaScript/Anonymous_Functions">anonymous function</a> that receives two parameters (named 'element' & 'i') as a parameter to the .each() function.<br> Once inside the .each() function, our anonymous function that we sent as a parameter is going to be referenced as the variable 'callback'.<br> Next, we do a cycle for each element on 'this' (the <code id="single">.each()</code> function was called by the <code id="single">humans[]</code> array, so 'this' will be a reference to the <code id="single">humans[]</code> array) and once the cycle starts we use the <code id="single">.call()</code> function on our 'callback' which receives (in this case) three parameters.</p>
<p>Alright so, <code id="single">callback.call()</code> will call the anonymous function we have stored in the 'callback' variable with the two parameters we needed, in our case we needed 'element' and 'i' plus one extra parameter (the first one) which will be a reference to the object that will be actually calling the 'callback' function. <br> So on <code id="single">callback.call(this[i], this[i], i);</code> the first parameter is the object that will be calling the 'callback' variable, the second parameter is the first parameter of the 'callback' function and so on, the n<sup>th</sup> parameter of a callback-style variable is the n-1<sup>th</sup> parameter of the function that was sent as a parameter.</p>
        
    </li>
    <li><h1>where()</h1>
        <p>Using the same JSON data let's say we only want information about people who are older than 29 years. It can be quite simple.</p>
        
        <pre><code data-language="javascript">//We easily iterate through all of that information
//but now we only want people older than 29.
humans.where(function(human){
        return human.age > 29;
    }).each(function(element,i){
        console.log(i+1 + ". " + element.name + " is " + element.age + " years old.");
});
/* Output: //////
1. Alan is 41 years old.
2. Randy is 32 years old.
3. Lawrence is 30 years old.
*/</code></pre>
        <p>Basically, we're following the same steps as before but now the <code id="single">.each()</code> function will be called once for each element from the <code id="single">humans[]</code> array whose age is above 29. Now here is the <code id="single">.where()</code> function.</p>
        <pre><code data-language="javascript">Array.prototype.where = function (callback) {
    var arr = [];
    for (var i=0; i&lt;this.length; i++) {
        if (callback.call(this[i], this[i])) {
            arr.push(this[i]);
        }
    }   
    return arr;
}</code></pre>
        <p>The <code id="single">.where()</code> function receives an anonymous function as a parameter. There is a cycle that will push <code id="single">this[i]</code> to the auxuliary array 'arr' only if the element <code id="single">this[i]</code> passes the test implemented by the provided 'callback' function; In this case the test is if <code id="single">human.age > 29</code>.</p>
        <p>Since the <code id="single">.where()</code> function returns an array, we can immideatly call and chain the <code id="single">.each()</code> function and iterate through each element that the <code id="single">.where()</code> function returned.</p>
    </li>
    <li> <h1>any()</h1>
    <p>Let's finish with the <code id="single">.any()</code> function. From the 5 people we have on our giant database, we'd like to send an email to any of those who like Netflix. We could try and use the where function, but we'd have to use it twice, like this:</p>
        <pre><code data-language="javascript">humans.where(function(human){ //Kind of confusing way.
            return human.likes.where( //Here we're calling the .where()
                function(like){       //function twice.
                    return like == "Netflix";
            }).length!=0;
    }).each(function(element,i){
            console.log(i+1 + ". " + element.name + " likes " + element.likes + ".");
});

humans.where(function(human){ //Easy way.
        return human.likes.any("Netflix");
    }).each(function(element,i){
        console.log(i+1 + ". " + element.name + " likes " + element.likes + ".");
});
/*Both method's outputs: //////
1. Alan likes Computer Science,Netflix,Artificial Intelligence.
2. Randy likes Cryptography,Netflix,Reading.
3. Lawrence likes Music,Netflix,Coding.
*/</code></pre>
    <p>The code above works the same for both ways. <br>The first way is kind of confusing, first you do a regular <code id="single">.where()</code> to find a certain characteristic of an element in <code id="single">humans[]</code>, the characteristic we're looking for is that one of the elements in the <code id="single">likes[]</code> element of <code id="single">humans[]</code> is equals to Netflix, so we have to call the <code id="single">.where()</code> function on <code id="single">human.likes[]</code> and that way we can check if that human likes Netflix. This doesn't seem as complicated but remember we're iterating through a bidimensional array because of the nested <code id="single">.where()</code> functions.<br>Here is the code for the <code id="single">.any()</code> function.</p>
        <pre><code data-language="javascript">Array.prototype.any=function (fun){
    for (var i=0; i &lt; this.length; i++){
        if( (typeof(fun)=='function' && fun.call(this,this[i])) || fun==this[i]){
            return true;
        }
    }
    return false;
};
</code></pre>
        <p>Starting, we can see this time that instead of a function, the function is receiving the string that we'd like to find on the <code id="single">likes[]</code> element of each human. Pretty much the <code id="single">.any()</code> function works like this: "If ANY element of the array I'm checking is equals to the object I got as a parameter, return True". </p>
        <p>So we receive the string as the 'fun' parameter, then we'll go in a cycle for the length of the array. Then we'll check if our fun variable is a function and then we'll call it to check if the test is passed.<br> If it is not a function, it'll just skip the <code id="single">fun.call()</code> part and we'll return True if the parameter we received this time is equals to the the element of 'this' we're currenly on.<br> Else, if none of the elements on 'this' (the Array) contain the 'fun' variable, we'll just return False and it will be skipped on the <code id="single">.where()</code> function's if.</p>
    </li>
</ul>
<p>And TA-DAH! That's all I should've done weeks ago. If you spot any errors or mistakes, don't hesitate to contact me!</p>
<p>A song for this post! <a href="https://www.youtube.com/watch?v=eTn9Nbax1IU"> Breeze by Bulb</a>.</p>